# 2024-12-30

## 1. 개발 진행 및 완료 사항

1. 투사체를 던지는 스킬 구현.
2. AttackHitCheck 의 로직을 MeleeAttack으로 옮기고 AttackHitCheck를 다른 용도로 사용하게 변경.
3. 투사체 던지는 스킬에 데미지 판정추가 후 모션 어빌리티와 투사체 생성하는 어빌리티를 통합

## 2. 오늘 발생한 이슈 및 고민

1. Ability를 사용하는 흐름 중 ActivateAbility를 호출 했을 때의 흐름에 대해 이해를 해야겠다.
2. Projectile 용으로 생성한 투사체(`CYActor`)가 움직이지도 않고 한번만 생성되는 현상이 발생
3. OnNotified의 Delgate를 호출할 때 OnNotifyBegin() 함수가 여러 번 호출되는 현상
4. 투사체 던지는 스킬을 Server에서 처리하도록 수정하였더니 투사체가 서버에만 생기는 현상

## 3. 고민 해결 방법 또는 새로 배운 내용

1. TryActivateAbility 함수는 Ability에 포함된 함수가 아니라 AbilitySystemComponent에 포함된 함수이다.
2. TimerManager를 사용하기 위해서는 `#include "TimerManager.h"` 를 추가해야한다. (Time이 아니다. Timer 다.)
3. Ability를 사용했으면 `EndAbility`를 반드시 호출해야 다음 Ability를 사용할 수 있다.
4. Notify가 호출되면 Client에서 자체호출, 서버에서 Replicate 되어 다시 호출되어 총 두번 처리가 된다. 

해당 문제를 해결하기 위해서 Notify가 발생될 때 `OwnerPawn->IsLocallyControlled()` 로 현재 컨트롤하고 있는 Pawn에 대해서만 Notify를 처리하도록 변경하였다. 

추가적으로 Notify와 연결되어있는 함수에는 `HasAuthority`를 통해서 서버에서만 AttackTrace에 관련된 로직을 실행하도록 추가하였다.
5. 투사체의 Replication 옵션을 활성화하여 클라이언트에서도 Replication 받도록 수정하였다. 추가적으로 BoxComponent를 StaticMesh의 부모로 삼았을 때 StaticMesh가 보이지 않는 현상이 발생하였는데 껐다 키니 정상적으로 보이게 되었다. 또 다른 문제 중 하나는 투사체가 생성되자마자 캐릭터와 충돌을 일으켜 생기지 않는 현상이 발생하였는데 최초 조건으로 `Instigator`와 `Other`를 비교하여 같다면 무시하도록 설정하였다.

## 4. 참고할 만한 레퍼런스

## 5. 특이사항

## 6. 전체 회고

충돌 처리 중 BoxComponent의 OnComponentOverlapBegin을 사용하는 방법이 제대로 적용되지 않았다. 아무래도 충돌에 대한 이해도가 모자라서 발생한 문제 같다. 

언리얼의 충돌은 Block, Overlap, Ignore가 존재하는데 이러한 설정들이 어떻게 상호작용하는지 복습을 해야할 것 같다.

오늘 어빌리티를 통합하는 과정을 두번 거쳤다. 이제 앞으로는 이러한 방식으로 어빌리티를 구현하고 서버에서만 동작하는 방식으로 잘 처리하게 구성한 것 같다.

## 7. 내일 할 일

1. 팀 시스템 구현
2. 게임 플로우 구현
    1. 게임 시작
    2. 시간 종료
    3. 재시작
    4. 리스폰
3. 캐릭터 사망 추가
4. 미니언 추가